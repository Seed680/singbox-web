import{P as A}from"./PageContainer-2AeyfqXh.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as _,B as y,k as N,c as P,o as v,e as n,w as r,f as i,b as c,n as g,y as b,p as f,E as s}from"./index-CTVkQrMm.js";const T={class:"download-config"},$={class:"download-form"},j={class:"download-url"},I={class:"download-url"},S={__name:"DownloadConfig",setup(D){const a=_({password:""}),l=_({save:!1,download:!1}),t=y(()=>a.value.password?`${window.location.origin}/api/config/download/${encodeURIComponent(a.value.password)}`:""),u=y(()=>a.value.password?`${window.location.origin}/api/config/download/${encodeURIComponent(a.value.password)}/android`:""),C=async()=>{try{if(navigator.clipboard&&window.isSecureContext){await navigator.clipboard.writeText(t.value),s.success("下载链接已复制到剪贴板");return}const e=document.createElement("textarea");e.value=t.value,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select();const o=document.execCommand("copy");if(document.body.removeChild(e),o)s.success("下载链接已复制到剪贴板");else throw new Error("复制失败")}catch(e){console.error("复制失败:",e),s.error("复制失败，请手动复制")}},x=async()=>{try{if(navigator.clipboard&&window.isSecureContext){await navigator.clipboard.writeText(u.value),s.success("Android下载链接已复制到剪贴板");return}const e=document.createElement("textarea");e.value=u.value,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select();const o=document.execCommand("copy");if(document.body.removeChild(e),o)s.success("Android下载链接已复制到剪贴板");else throw new Error("复制失败")}catch(e){console.error("复制失败:",e),s.error("复制失败，请手动复制")}},U=async()=>{try{const e=await fetch("/api/config/download-password");if(e.ok){const o=await e.json();a.value.password=o.password||""}}catch(e){console.error("获取密码失败:",e)}},k=async()=>{if(!a.value.password){s.warning("请输入下载密码");return}l.value.save=!0;try{const e=await fetch("/api/config/download-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:a.value.password})});if(e.ok)s.success("密码设置成功");else{const o=await e.json();s.error(o.error||"密码设置失败")}}catch(e){console.error("设置密码失败:",e),s.error("网络错误")}finally{l.value.save=!1}},V=async()=>{if(!a.value.password){s.warning("请先设置并保存下载密码");return}l.value.download=!0;try{const e=await fetch(`/api/config/download/${encodeURIComponent(a.value.password)}`);if(e.ok)window.location.href=t.value;else{const o=await e.json();s.error(o.error||"下载失败")}}catch(e){console.error("下载失败:",e),s.error("网络错误")}finally{l.value.download=!1}};return N(()=>{U()}),(e,o)=>{const m=i("el-input"),p=i("el-form-item"),w=i("el-button"),h=i("el-form"),E=i("el-card");return v(),P("div",T,[n(A,null,{default:r(()=>[n(E,null,{header:r(()=>o[3]||(o[3]=[c("div",{class:"card-header"},[c("span",null,"下载配置")],-1)])),default:r(()=>[c("div",$,[n(h,{model:a.value,"label-width":"120px"},{default:r(()=>[n(p,{label:"下载密码"},{default:r(()=>[n(m,{modelValue:a.value.password,"onUpdate:modelValue":o[0]||(o[0]=d=>a.value.password=d),placeholder:"请设置下载配置文件的密码"},null,8,["modelValue"])]),_:1}),n(p,null,{default:r(()=>[n(w,{type:"primary",onClick:k,loading:l.value.save},{default:r(()=>o[4]||(o[4]=[f("保存密码")])),_:1,__:[4]},8,["loading"]),n(w,{type:"success",onClick:V,loading:l.value.download},{default:r(()=>o[5]||(o[5]=[f("下载配置")])),_:1,__:[5]},8,["loading"])]),_:1}),a.value.password?(v(),g(p,{key:0,label:"下载链接"},{default:r(()=>[c("div",j,[n(m,{modelValue:t.value,"onUpdate:modelValue":o[1]||(o[1]=d=>t.value=d),readonly:"",disabled:!a.value.password},{append:r(()=>[n(w,{onClick:C},{default:r(()=>o[6]||(o[6]=[f("复制")])),_:1,__:[6]})]),_:1},8,["modelValue","disabled"])])]),_:1})):b("",!0),a.value.password?(v(),g(p,{key:1,label:"Android下载链接"},{default:r(()=>[c("div",I,[n(m,{modelValue:u.value,"onUpdate:modelValue":o[2]||(o[2]=d=>u.value=d),readonly:"",disabled:!a.value.password},{append:r(()=>[n(w,{onClick:x},{default:r(()=>o[7]||(o[7]=[f("复制")])),_:1,__:[7]})]),_:1},8,["modelValue","disabled"])])]),_:1})):b("",!0)]),_:1},8,["model"])])]),_:1})]),_:1})])}}},J=B(S,[["__scopeId","data-v-6d45e980"]]);export{J as default};
