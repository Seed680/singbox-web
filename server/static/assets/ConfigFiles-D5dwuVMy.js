import{J as h}from"./jsoneditor-DKimo5TI.js";import{_ as j,P as T}from"./PageContainer-BIDKZJWI.js";import{c as x,b as P,w as d,d as p,r as v,o as S,E as n,z as N,y as O,m as z,e as a,f as g,g as m,t as w,n as E}from"./index-D0h7X9x_.js";const M={name:"ConfigFiles",components:{PageContainer:T},setup(){const C=v(null),s=v(null),c=v(!1),o=v(!1);let i=null,r=null;const l={mode:"code",themes:["ace/theme/monokai"],language:"json",indentation:2,tabSize:2,search:!0,statusBar:!0,navigationBar:!0,onError:e=>{console.error("JSON Editor Error:",e),n.error("JSON 格式错误: "+e.message)}},u=async()=>{c.value=!0;try{const t=await(await fetch("/api/base-config")).json();if(t.success)i?(i.set(t.config),n.success("基础配置加载成功")):n.error("编辑器未初始化");else throw new Error(t.error||"加载基础配置失败")}catch(e){console.error("加载基础配置失败:",e),n.error("加载基础配置失败: "+e.message)}finally{c.value=!1}},_=async()=>{if(i)try{const e=i.get();c.value=!0;const f=await(await fetch("/api/base-config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({config:e})})).json();if(f.success)n.success("基础配置保存成功");else throw new Error(f.error||"保存基础配置失败")}catch(e){console.error("保存基础配置失败:",e),n.error("保存基础配置失败: "+e.message)}finally{c.value=!1}},y=async()=>{o.value=!0;try{const t=await(await fetch("/api/config")).json();if(t.success)r?(r.set(t.config),n.success("当前配置加载成功")):n.error("编辑器未初始化");else throw new Error(t.error||"加载当前配置失败")}catch(e){console.error("加载当前配置失败:",e),n.error("加载当前配置失败: "+e.message)}finally{o.value=!1}},b=async()=>{if(r)try{const e=r.get();o.value=!0;const f=await(await fetch("/api/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(f.success)n.success("当前配置保存成功");else throw new Error(f.error||"保存当前配置失败")}catch(e){console.error("保存当前配置失败:",e),n.error("保存当前配置失败: "+e.message)}finally{o.value=!1}},B=async()=>{try{if(await O.confirm("确定要将当前配置重置为基础配置吗？这将覆盖现有的 config.json 文件。","重置确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),!i){n.error("请先加载基础配置");return}const e=i.get();r&&r.set(e),await b(),n.success("配置已重置为基础配置")}catch(e){e!=="cancel"&&(console.error("重置配置失败:",e),n.error("重置配置失败"))}},L=()=>{try{C.value&&!i&&(i=new h(C.value,{...l,onChange:()=>{}})),s.value&&!r&&(r=new h(s.value,{...l,onChange:()=>{}}))}catch(e){console.error("编辑器初始化失败:",e),n.error("编辑器初始化失败: "+e.message)}},k=()=>{i&&(i.destroy(),i=null),r&&(r.destroy(),r=null)};return S(async()=>{await new Promise(e=>setTimeout(e,100));try{L(),await new Promise(e=>setTimeout(e,200)),await Promise.all([u(),y()])}catch(e){console.error("初始化过程出错:",e),n.error("页面初始化失败: "+e.message)}}),N(()=>{k()}),{baseConfigEditor:C,mainConfigEditor:s,baseConfigLoading:c,mainConfigLoading:o,loadBaseConfig:u,saveBaseConfig:_,loadMainConfig:y,saveMainConfig:b,resetToBaseConfig:B}}},J={class:"config-files-container"},D={class:"config-panel"},V={class:"panel-header"},F={class:"panel-actions"},I={class:"editor-container"},U={ref:"baseConfigEditor",class:"json-editor","element-loading-text":"加载中..."},q={class:"config-panel"},A={class:"panel-header"},G={class:"panel-actions"},H={class:"editor-container"},K={ref:"mainConfigEditor",class:"json-editor","element-loading-text":"加载中..."};function Q(C,s,c,o,i,r){const l=p("el-button"),u=p("PageContainer"),_=z("loading");return P(),x(u,{title:"配置文件管理"},{default:d(()=>[a("div",J,[a("div",D,[a("div",V,[s[1]||(s[1]=a("h3",null,"基础配置 (base_config.json)",-1)),a("div",F,[g(l,{type:"primary",size:"small",loading:o.baseConfigLoading,onClick:o.saveBaseConfig,disabled:o.baseConfigLoading},{default:d(()=>[m(w(o.baseConfigLoading?"保存中...":"保存基础配置"),1)]),_:1},8,["loading","onClick","disabled"]),g(l,{size:"small",onClick:o.loadBaseConfig,disabled:o.baseConfigLoading},{default:d(()=>s[0]||(s[0]=[m(" 重新加载 ")])),_:1,__:[0]},8,["onClick","disabled"])])]),a("div",I,[E(a("div",U,null,512),[[_,o.baseConfigLoading]])])]),a("div",q,[a("div",A,[s[4]||(s[4]=a("h3",null,"当前配置 (config.json)",-1)),a("div",G,[g(l,{type:"primary",size:"small",loading:o.mainConfigLoading,onClick:o.saveMainConfig,disabled:o.mainConfigLoading},{default:d(()=>[m(w(o.mainConfigLoading?"保存中...":"保存当前配置"),1)]),_:1},8,["loading","onClick","disabled"]),g(l,{size:"small",onClick:o.loadMainConfig,disabled:o.mainConfigLoading},{default:d(()=>s[2]||(s[2]=[m(" 重新加载 ")])),_:1,__:[2]},8,["onClick","disabled"]),g(l,{size:"small",type:"warning",onClick:o.resetToBaseConfig,disabled:o.baseConfigLoading||o.mainConfigLoading},{default:d(()=>s[3]||(s[3]=[m(" 重置为基础配置 ")])),_:1,__:[3]},8,["onClick","disabled"])])]),a("div",H,[E(a("div",K,null,512),[[_,o.mainConfigLoading]])])])])]),_:1})}const Y=j(M,[["render",Q],["__scopeId","data-v-27befb48"]]);export{Y as default};
