import{_ as A,P as N}from"./PageContainer-DJMCC9Qe.js";import{r as _,q as y,o as P,l as T,b as v,f as l,w as s,d as i,e as c,c as g,k as b,g as f,E as r}from"./index-CTwIvjYb.js";const $={class:"download-config"},j={class:"download-form"},B={class:"download-url"},I={class:"download-url"},S={__name:"DownloadConfig",setup(D){const a=_({password:""}),n=_({save:!1,download:!1}),t=y(()=>a.value.password?`${window.location.origin}/api/config/download/${encodeURIComponent(a.value.password)}`:""),u=y(()=>a.value.password?`${window.location.origin}/api/config/download/${encodeURIComponent(a.value.password)}/android`:""),C=async()=>{try{if(navigator.clipboard&&window.isSecureContext){await navigator.clipboard.writeText(t.value),r.success("下载链接已复制到剪贴板");return}const e=document.createElement("textarea");e.value=t.value,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select();const o=document.execCommand("copy");if(document.body.removeChild(e),o)r.success("下载链接已复制到剪贴板");else throw new Error("复制失败")}catch(e){console.error("复制失败:",e),r.error("复制失败，请手动复制")}},x=async()=>{try{if(navigator.clipboard&&window.isSecureContext){await navigator.clipboard.writeText(u.value),r.success("Android下载链接已复制到剪贴板");return}const e=document.createElement("textarea");e.value=u.value,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select();const o=document.execCommand("copy");if(document.body.removeChild(e),o)r.success("Android下载链接已复制到剪贴板");else throw new Error("复制失败")}catch(e){console.error("复制失败:",e),r.error("复制失败，请手动复制")}},U=async()=>{try{const e=await fetch("/api/config/download-password");if(e.ok){const o=await e.json();a.value.password=o.password||""}}catch(e){console.error("获取密码失败:",e)}},k=async()=>{if(!a.value.password){r.warning("请输入下载密码");return}n.value.save=!0;try{const e=await fetch("/api/config/download-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:a.value.password})});if(e.ok)r.success("密码设置成功");else{const o=await e.json();r.error(o.error||"密码设置失败")}}catch(e){console.error("设置密码失败:",e),r.error("网络错误")}finally{n.value.save=!1}},V=async()=>{if(!a.value.password){r.warning("请先设置并保存下载密码");return}n.value.download=!0;try{const e=await fetch(`/api/config/download/${encodeURIComponent(a.value.password)}`);if(e.ok)window.location.href=t.value;else{const o=await e.json();r.error(o.error||"下载失败")}}catch(e){console.error("下载失败:",e),r.error("网络错误")}finally{n.value.download=!1}};return P(()=>{U()}),(e,o)=>{const m=i("el-input"),p=i("el-form-item"),w=i("el-button"),h=i("el-form"),E=i("el-card");return v(),T("div",$,[l(N,null,{default:s(()=>[l(E,null,{header:s(()=>o[3]||(o[3]=[c("div",{class:"card-header"},[c("span",null,"下载配置")],-1)])),default:s(()=>[c("div",j,[l(h,{model:a.value,"label-width":"120px"},{default:s(()=>[l(p,{label:"下载密码"},{default:s(()=>[l(m,{modelValue:a.value.password,"onUpdate:modelValue":o[0]||(o[0]=d=>a.value.password=d),placeholder:"请设置下载配置文件的密码"},null,8,["modelValue"])]),_:1}),l(p,null,{default:s(()=>[l(w,{type:"primary",onClick:k,loading:n.value.save},{default:s(()=>o[4]||(o[4]=[f("保存密码")])),_:1,__:[4]},8,["loading"]),l(w,{type:"success",onClick:V,loading:n.value.download},{default:s(()=>o[5]||(o[5]=[f("下载配置")])),_:1,__:[5]},8,["loading"])]),_:1}),a.value.password?(v(),g(p,{key:0,label:"下载链接"},{default:s(()=>[c("div",B,[l(m,{modelValue:t.value,"onUpdate:modelValue":o[1]||(o[1]=d=>t.value=d),readonly:"",disabled:!a.value.password},{append:s(()=>[l(w,{onClick:C},{default:s(()=>o[6]||(o[6]=[f("复制")])),_:1,__:[6]})]),_:1},8,["modelValue","disabled"])])]),_:1})):b("",!0),a.value.password?(v(),g(p,{key:1,label:"Android下载链接"},{default:s(()=>[c("div",I,[l(m,{modelValue:u.value,"onUpdate:modelValue":o[2]||(o[2]=d=>u.value=d),readonly:"",disabled:!a.value.password},{append:s(()=>[l(w,{onClick:x},{default:s(()=>o[7]||(o[7]=[f("复制")])),_:1,__:[7]})]),_:1},8,["modelValue","disabled"])])]),_:1})):b("",!0)]),_:1},8,["model"])])]),_:1})]),_:1})])}}},O=A(S,[["__scopeId","data-v-6d45e980"]]);export{O as default};
