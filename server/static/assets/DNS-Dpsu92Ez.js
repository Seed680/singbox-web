import{r as d,k as N,m as h,n as D,o as y,w as i,E as a,f as u,C as w,b as s,e as l,p as E,i as B,A as k,t as x,D as C}from"./index-CTVkQrMm.js";import{P as b}from"./PageContainer-2AeyfqXh.js";import{J}from"./jsoneditor-rjmmijB1.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const P={class:"dns"},T={class:"page-header"},j={id:"dnsEditor",style:{width:"100%",height:"500px"}},f="/api",A={__name:"DNS",setup(I){const t=d(null),r=d(!1),c=d(!1),_=()=>{const e=document.getElementById("dnsEditor"),o={mode:"code",modes:["code","tree","view","form","text"],onError:function(n){a.error("JSON 格式错误："+n.toString())},mainMenuBar:!0,navigationBar:!1,statusBar:!0,colorPicker:!1,search:!0,format:!0,repair:!0};t.value=new J(e,o)},p=async()=>{try{c.value=!0;const e=await fetch(`${f}/dns`);if(e.ok){const o=await e.json();t.value&&t.value.set(o.dns||{})}else a.error("加载DNS配置失败")}catch(e){console.error("加载DNS配置失败:",e),a.error("加载DNS配置失败，请检查后端服务是否启动")}finally{c.value=!1}},v=async()=>{try{r.value=!0;const e=t.value.get(),o=await fetch(`${f}/dns`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dns:e})});if(o.ok)a.success("DNS配置保存成功");else{const n=await o.json();a.error(n.error||"DNS配置保存失败")}}catch(e){console.error("保存DNS配置失败:",e),a.error("保存失败，请检查JSON格式是否正确")}finally{r.value=!1}};return N(()=>{_(),setTimeout(()=>{p()},100)}),h(()=>{t.value&&t.value.destroy()}),(e,o)=>{const n=u("el-icon"),m=u("el-button"),S=u("el-card"),g=w("loading");return y(),D(b,null,{default:i(()=>[s("div",P,[s("div",T,[o[0]||(o[0]=s("h2",{class:"page-title"},"DNS 配置",-1)),l(m,{type:"primary",onClick:v,loading:r.value},{default:i(()=>[l(n,null,{default:i(()=>[l(B(k))]),_:1}),E(" "+x(r.value?"保存中...":"保存"),1)]),_:1},8,["loading"])]),l(S,{class:"box-card"},{header:i(()=>o[1]||(o[1]=[s("div",{class:"card-header"},[s("span",null,"DNS 配置")],-1)])),default:i(()=>[C(s("div",j,null,512),[[g,r.value||c.value]])]),_:1})])]),_:1})}}},U=O(A,[["__scopeId","data-v-8613e081"]]);export{U as default};
