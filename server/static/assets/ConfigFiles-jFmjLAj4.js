import{J as v}from"./jsoneditor-olEp2avP.js";import{P as j}from"./PageContainer-ChjlHtAI.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{n as x,o as P,w as d,f as w,r as h,k as S,E as n,L as O,K as N,C as M,b as a,e as g,p as m,t as y,D as b}from"./index-EJWQmZrC.js";const z={name:"ConfigFiles",components:{PageContainer:j},setup(){const C=h(null),s=h(null),c=h(!1),o=h(!1);let r=null,t=null;const l={mode:"code",themes:["ace/theme/monokai"],language:"json",indentation:2,tabSize:2,search:!0,statusBar:!0,navigationBar:!0,onError:e=>{console.error("JSON Editor Error:",e),n.error("JSON 格式错误: "+e.message)}},u=async()=>{c.value=!0;try{const i=await(await fetch("/api/base-config")).json();if(i.success)r?(r.set(i.config),n.success("基础配置加载成功")):n.error("编辑器未初始化");else throw new Error(i.error||"加载基础配置失败")}catch(e){console.error("加载基础配置失败:",e),n.error("加载基础配置失败: "+e.message)}finally{c.value=!1}},_=async()=>{if(r)try{const e=r.get();c.value=!0;const f=await(await fetch("/api/base-config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({config:e})})).json();if(f.success)n.success("基础配置保存成功");else throw new Error(f.error||"保存基础配置失败")}catch(e){console.error("保存基础配置失败:",e),n.error("保存基础配置失败: "+e.message)}finally{c.value=!1}},p=async()=>{o.value=!0;try{const i=await(await fetch("/api/config")).json();if(i.success)t?(t.set(i.config),n.success("当前配置加载成功")):n.error("编辑器未初始化");else throw new Error(i.error||"加载当前配置失败")}catch(e){console.error("加载当前配置失败:",e),n.error("加载当前配置失败: "+e.message)}finally{o.value=!1}},E=async()=>{if(t)try{const e=t.get();o.value=!0;const f=await(await fetch("/api/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(f.success)n.success("当前配置保存成功");else throw new Error(f.error||"保存当前配置失败")}catch(e){console.error("保存当前配置失败:",e),n.error("保存当前配置失败: "+e.message)}finally{o.value=!1}},k=async()=>{try{await N.confirm("确定要将当前配置重置为基础配置吗？这将立即覆盖 config.json 文件。","重置确认",{confirmButtonText:"确定重置",cancelButtonText:"取消",type:"warning"});const e=await fetch("/api/config/reset",{method:"POST"}),i=await e.json();if(e.ok&&i.success)n.success("当前配置已成功重置！正在重新加载..."),await p();else throw new Error(i.error||"重置失败")}catch(e){e!=="cancel"&&e.message!=="cancel"&&(console.error("重置配置失败:",e),n.error("重置失败: "+(e.message||e)))}},L=()=>{try{C.value&&!r&&(r=new v(C.value,{...l,onChange:()=>{}})),s.value&&!t&&(t=new v(s.value,{...l,onChange:()=>{}}))}catch(e){console.error("编辑器初始化失败:",e),n.error("编辑器初始化失败: "+e.message)}},B=()=>{r&&(r.destroy(),r=null),t&&(t.destroy(),t=null)};return S(async()=>{await new Promise(e=>setTimeout(e,100));try{L(),await new Promise(e=>setTimeout(e,200)),await Promise.all([u(),p()])}catch(e){console.error("初始化过程出错:",e),n.error("页面初始化失败: "+e.message)}}),O(()=>{B()}),{baseConfigEditor:C,mainConfigEditor:s,baseConfigLoading:c,mainConfigLoading:o,loadBaseConfig:u,saveBaseConfig:_,loadMainConfig:p,saveMainConfig:E,resetToBaseConfig:k}}},J={class:"config-files-container"},D={class:"config-panel"},V={class:"panel-header"},F={class:"panel-actions"},I={class:"editor-container"},K={ref:"baseConfigEditor",class:"json-editor","element-loading-text":"加载中..."},U={class:"config-panel"},q={class:"panel-header"},A={class:"panel-actions"},G={class:"editor-container"},H={ref:"mainConfigEditor",class:"json-editor","element-loading-text":"加载中..."};function Q(C,s,c,o,r,t){const l=w("el-button"),u=w("PageContainer"),_=M("loading");return P(),x(u,{title:"配置文件管理"},{default:d(()=>[a("div",J,[a("div",D,[a("div",V,[s[1]||(s[1]=a("h3",null,"基础配置 (base_config.json)",-1)),a("div",F,[g(l,{type:"primary",size:"small",loading:o.baseConfigLoading,onClick:o.saveBaseConfig,disabled:o.baseConfigLoading},{default:d(()=>[m(y(o.baseConfigLoading?"保存中...":"保存基础配置"),1)]),_:1},8,["loading","onClick","disabled"]),g(l,{size:"small",onClick:o.loadBaseConfig,disabled:o.baseConfigLoading},{default:d(()=>s[0]||(s[0]=[m(" 重新加载 ")])),_:1,__:[0]},8,["onClick","disabled"])])]),a("div",I,[b(a("div",K,null,512),[[_,o.baseConfigLoading]])])]),a("div",U,[a("div",q,[s[4]||(s[4]=a("h3",null,"当前配置 (config.json)",-1)),a("div",A,[g(l,{type:"primary",size:"small",loading:o.mainConfigLoading,onClick:o.saveMainConfig,disabled:o.mainConfigLoading},{default:d(()=>[m(y(o.mainConfigLoading?"保存中...":"保存当前配置"),1)]),_:1},8,["loading","onClick","disabled"]),g(l,{size:"small",onClick:o.loadMainConfig,disabled:o.mainConfigLoading},{default:d(()=>s[2]||(s[2]=[m(" 重新加载 ")])),_:1,__:[2]},8,["onClick","disabled"]),g(l,{size:"small",type:"warning",onClick:o.resetToBaseConfig,disabled:o.baseConfigLoading||o.mainConfigLoading},{default:d(()=>s[3]||(s[3]=[m(" 重置为基础配置 ")])),_:1,__:[3]},8,["onClick","disabled"])])]),a("div",G,[b(a("div",H,null,512),[[_,o.mainConfigLoading]])])])])]),_:1})}const Z=T(z,[["render",Q],["__scopeId","data-v-93c74799"]]);export{Z as default};
