import{r as d,k as h,m as y,n as w,o as E,w as i,E as t,f as u,C as B,b as a,e as l,p as S,i as k,A as x,t as C,D as I}from"./index-CTVkQrMm.js";import{P as N}from"./PageContainer-2AeyfqXh.js";import{J}from"./jsoneditor-rjmmijB1.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const P={class:"inbound"},D={class:"page-header"},T={id:"inboundEditor",style:{width:"100%",height:"500px"}},f="/api",j={__name:"Inbound",setup(A){const n=d(null),r=d(!1),c=d(!1),_=()=>{const e=document.getElementById("inboundEditor"),o={mode:"code",modes:["code","tree","view","form","text"],onError:function(s){t.error("JSON 格式错误："+s.toString())},mainMenuBar:!0,navigationBar:!1,statusBar:!0,colorPicker:!1,search:!0,format:!0,repair:!0};n.value=new J(e,o)},p=async()=>{try{c.value=!0;const e=await fetch(`${f}/inbounds`);if(e.ok){const o=await e.json();n.value&&n.value.set(o.inbounds||[])}else t.error("加载入站配置失败")}catch(e){console.error("加载入站配置失败:",e),t.error("加载入站配置失败，请检查后端服务是否启动")}finally{c.value=!1}},v=async()=>{try{r.value=!0;const e=n.value.get(),o=await fetch(`${f}/inbounds`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inbounds:e})});if(o.ok)t.success("入站配置保存成功");else{const s=await o.json();t.error(s.error||"入站配置保存失败")}}catch(e){console.error("保存入站配置失败:",e),t.error("保存失败，请检查JSON格式是否正确")}finally{r.value=!1}};return h(()=>{_(),setTimeout(()=>{p()},100)}),y(()=>{n.value&&n.value.destroy()}),(e,o)=>{const s=u("el-icon"),m=u("el-button"),g=u("el-card"),b=B("loading");return E(),w(N,null,{default:i(()=>[a("div",P,[a("div",D,[o[0]||(o[0]=a("h2",{class:"page-title"},"入站配置",-1)),l(m,{type:"primary",onClick:v,loading:r.value},{default:i(()=>[l(s,null,{default:i(()=>[l(k(x))]),_:1}),S(" "+C(r.value?"保存中...":"保存"),1)]),_:1},8,["loading"])]),l(g,{class:"box-card"},{header:i(()=>o[1]||(o[1]=[a("div",{class:"card-header"},[a("span",null,"入站配置")],-1)])),default:i(()=>[I(a("div",T,null,512),[[b,r.value||c.value]])]),_:1})])]),_:1})}}},U=O(j,[["__scopeId","data-v-a2f99031"]]);export{U as default};
