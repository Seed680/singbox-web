import{r as u,a as N,k as b,m as J,n as P,o as T,w as n,E as a,f as p,C as j,b as s,e as i,D as v,p as h,i as x,A as y,t as E}from"./index-CTVkQrMm.js";import{P as D}from"./PageContainer-2AeyfqXh.js";import{J as S}from"./jsoneditor-rjmmijB1.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";const M={class:"other-settings"},A={class:"card-header"},L={id:"experimentalEditor",style:{width:"100%",height:"400px"}},V={class:"card-header"},$={id:"logEditor",style:{width:"100%",height:"400px"}},f="/api",U={__name:"OtherSettings",setup(q){const l=u(null),c=u(null),o=N({experimental:!1,log:!1}),d=u(!1),w=()=>{const t=document.getElementById("experimentalEditor"),e={mode:"code",modes:["code","tree","view","form","text"],onError:function(r){a.error("JSON 格式错误："+r.toString())},mainMenuBar:!0,navigationBar:!1,statusBar:!0,colorPicker:!1,search:!0,format:!0,repair:!0};l.value=new S(t,e)},B=()=>{const t=document.getElementById("logEditor"),e={mode:"code",modes:["code","tree","view","form","text"],onError:function(r){a.error("JSON 格式错误："+r.toString())},mainMenuBar:!0,navigationBar:!1,statusBar:!0,colorPicker:!1,search:!0,format:!0,repair:!0};c.value=new S(t,e)},k=async()=>{try{d.value=!0;const t=await fetch(`${f}/config`);if(t.ok){const e=await t.json();l.value&&l.value.set(e.main.experimental||{}),c.value&&c.value.set(e.main.log||{})}else a.error("加载配置失败")}catch(t){console.error("加载配置失败:",t),a.error("加载配置失败，请检查后端服务是否启动")}finally{d.value=!1}},C=async()=>{try{o.experimental=!0;const t=l.value.get(),e=await fetch(`${f}/experimental`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({experimental:t})});if(e.ok)a.success("实验性功能配置保存成功");else{const r=await e.json();a.error(r.error||"实验性功能配置保存失败")}}catch(t){console.error("保存实验性功能配置失败:",t),a.error("保存失败，请检查JSON格式是否正确")}finally{o.experimental=!1}},O=async()=>{try{o.log=!0;const t=c.value.get(),e=await fetch(`${f}/log`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({log:t})});if(e.ok)a.success("日志配置保存成功");else{const r=await e.json();a.error(r.error||"日志配置保存失败")}}catch(t){console.error("保存日志配置失败:",t),a.error("保存失败，请检查JSON格式是否正确")}finally{o.log=!1}};return b(()=>{w(),B(),setTimeout(()=>{k()},100)}),J(()=>{l.value&&l.value.destroy(),c.value&&c.value.destroy()}),(t,e)=>{const r=p("el-icon"),m=p("el-button"),g=p("el-card"),_=j("loading");return T(),P(D,null,{default:n(()=>[s("div",M,[e[2]||(e[2]=s("div",{class:"page-header"},[s("h2",{class:"page-title"},"其他设置")],-1)),i(g,{class:"box-card"},{header:n(()=>[s("div",A,[e[0]||(e[0]=s("span",null,"实验性功能配置",-1)),i(m,{type:"primary",onClick:C,loading:o.experimental},{default:n(()=>[i(r,null,{default:n(()=>[i(x(y))]),_:1}),h(" "+E(o.experimental?"保存中...":"保存"),1)]),_:1},8,["loading"])])]),default:n(()=>[v(s("div",L,null,512),[[_,o.experimental||d.value]])]),_:1}),i(g,{class:"box-card"},{header:n(()=>[s("div",V,[e[1]||(e[1]=s("span",null,"日志配置",-1)),i(m,{type:"primary",onClick:O,loading:o.log},{default:n(()=>[i(r,null,{default:n(()=>[i(x(y))]),_:1}),h(" "+E(o.log?"保存中...":"保存"),1)]),_:1},8,["loading"])])]),default:n(()=>[v(s("div",$,null,512),[[_,o.log||d.value]])]),_:1})])]),_:1})}}},K=I(U,[["__scopeId","data-v-b4b638e2"]]);export{K as default};
