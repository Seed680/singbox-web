import{_ as V,P as U}from"./PageContainer-V0UEeMgc.js";import{r as _,p as h,o as x,k as j,b as m,f as r,w as s,d as t,e as i,c as N,j as P,g as w,E as l}from"./index-CP9QC06r.js";const B={class:"download-config"},T={class:"download-form"},E={class:"download-url"},I={__name:"DownloadConfig",setup($){const a=_({password:""}),n=_({save:!1,download:!1}),d=h(()=>a.value.password?`${window.location.origin}/api/config/download/${encodeURIComponent(a.value.password)}`:""),v=async()=>{try{await navigator.clipboard.writeText(d.value),l.success("下载链接已复制到剪贴板")}catch{l.error("复制失败，请手动复制")}},g=async()=>{try{const e=await fetch("/api/config/download-password");if(e.ok){const o=await e.json();a.value.password=o.password||""}}catch(e){console.error("获取密码失败:",e)}},y=async()=>{if(!a.value.password){l.warning("请输入下载密码");return}n.value.save=!0;try{const e=await fetch("/api/config/download-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:a.value.password})});if(e.ok)l.success("密码设置成功");else{const o=await e.json();l.error(o.error||"密码设置失败")}}catch(e){console.error("设置密码失败:",e),l.error("网络错误")}finally{n.value.save=!1}},C=async()=>{if(!a.value.password){l.warning("请先设置并保存下载密码");return}n.value.download=!0;try{const e=await fetch(`/api/config/download/${encodeURIComponent(a.value.password)}`);if(e.ok)window.location.href=d.value;else{const o=await e.json();l.error(o.error||"下载失败")}}catch(e){console.error("下载失败:",e),l.error("网络错误")}finally{n.value.download=!1}};return x(()=>{g()}),(e,o)=>{const f=t("el-input"),c=t("el-form-item"),u=t("el-button"),b=t("el-form"),k=t("el-card");return m(),j("div",B,[r(U,null,{default:s(()=>[r(k,null,{header:s(()=>o[2]||(o[2]=[i("div",{class:"card-header"},[i("span",null,"下载配置")],-1)])),default:s(()=>[i("div",T,[r(b,{model:a.value,"label-width":"120px"},{default:s(()=>[r(c,{label:"下载密码"},{default:s(()=>[r(f,{modelValue:a.value.password,"onUpdate:modelValue":o[0]||(o[0]=p=>a.value.password=p),placeholder:"请设置下载配置文件的密码"},null,8,["modelValue"])]),_:1}),r(c,null,{default:s(()=>[r(u,{type:"primary",onClick:y,loading:n.value.save},{default:s(()=>o[3]||(o[3]=[w("保存密码")])),_:1,__:[3]},8,["loading"]),r(u,{type:"success",onClick:C,loading:n.value.download},{default:s(()=>o[4]||(o[4]=[w("下载配置")])),_:1,__:[4]},8,["loading"])]),_:1}),a.value.password?(m(),N(c,{key:0,label:"下载链接"},{default:s(()=>[i("div",E,[r(f,{modelValue:d.value,"onUpdate:modelValue":o[1]||(o[1]=p=>d.value=p),readonly:"",disabled:!a.value.password},{append:s(()=>[r(u,{onClick:v},{default:s(()=>o[5]||(o[5]=[w("复制")])),_:1,__:[5]})]),_:1},8,["modelValue","disabled"])])]),_:1})):P("",!0)]),_:1},8,["model"])])]),_:1})]),_:1})])}}},O=V(I,[["__scopeId","data-v-e4e76157"]]);export{O as default};
