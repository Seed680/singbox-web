import{P as V}from"./PageContainer-ChjlHtAI.js";import{_ as b}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as c,a as h,c as C,o as x,e as o,w as r,f as d,b as p,p as _,E as w}from"./index-EJWQmZrC.js";const E={class:"change-password"},N={class:"password-form"},k={__name:"ChangePassword",setup(q){const l=c(),u=c(!1),s=h({oldPassword:"",newPassword:"",confirmPassword:""}),P={oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"新密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,validator:(n,e,a)=>{e===""?a(new Error("请再次输入新密码")):e!==s.newPassword?a(new Error("两次输入的密码不一致")):a()},trigger:"blur"}]},g=async()=>{if(l.value)try{await l.value.validate(),u.value=!0;const e=await(await fetch("/api/auth/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({oldPassword:s.oldPassword,newPassword:s.newPassword})})).json();e.success?(w.success("密码修改成功"),m()):w.error(e.error||"密码修改失败")}catch(n){console.error("修改密码失败:",n),w.error("修改密码失败，请检查网络连接")}finally{u.value=!1}},m=()=>{l.value&&l.value.resetFields()};return(n,e)=>{const a=d("el-input"),i=d("el-form-item"),f=d("el-button"),v=d("el-form"),y=d("el-card");return x(),C("div",E,[o(V,null,{default:r(()=>[o(y,null,{header:r(()=>e[3]||(e[3]=[p("div",{class:"card-header"},[p("span",null,"修改密码")],-1)])),default:r(()=>[p("div",N,[o(v,{model:s,rules:P,ref_key:"formRef",ref:l,"label-width":"120px"},{default:r(()=>[o(i,{label:"当前密码",prop:"oldPassword"},{default:r(()=>[o(a,{modelValue:s.oldPassword,"onUpdate:modelValue":e[0]||(e[0]=t=>s.oldPassword=t),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),o(i,{label:"新密码",prop:"newPassword"},{default:r(()=>[o(a,{modelValue:s.newPassword,"onUpdate:modelValue":e[1]||(e[1]=t=>s.newPassword=t),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),o(i,{label:"确认新密码",prop:"confirmPassword"},{default:r(()=>[o(a,{modelValue:s.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=t=>s.confirmPassword=t),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),o(i,null,{default:r(()=>[o(f,{type:"primary",onClick:g,loading:u.value},{default:r(()=>e[4]||(e[4]=[_(" 修改密码 ")])),_:1,__:[4]},8,["loading"]),o(f,{onClick:m},{default:r(()=>e[5]||(e[5]=[_("重置")])),_:1,__:[5]})]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1})])}}},j=b(k,[["__scopeId","data-v-962d85ac"]]);export{j as default};
