import{r as u,k as N,o as b,a as J,c as P,b as j,w as n,E as a,d as f,m as T,e as s,f as l,n as v,g as h,u as x,j as y,t as E}from"./index-D0h7X9x_.js";import{_ as I,P as M}from"./PageContainer-BIDKZJWI.js";import{J as S}from"./jsoneditor-DKimo5TI.js";const D={class:"other-settings"},L={class:"card-header"},V={id:"experimentalEditor",style:{width:"100%",height:"400px"}},$={class:"card-header"},A={id:"logEditor",style:{width:"100%",height:"400px"}},p="/api",U={__name:"OtherSettings",setup(q){const i=u(null),c=u(null),o=N({experimental:!1,log:!1}),d=u(!1),w=()=>{const t=document.getElementById("experimentalEditor"),e={mode:"code",modes:["code","tree","view","form","text"],onError:function(r){a.error("JSON 格式错误："+r.toString())},mainMenuBar:!0,navigationBar:!1,statusBar:!0,colorPicker:!1,search:!0,format:!0,repair:!0};i.value=new S(t,e)},B=()=>{const t=document.getElementById("logEditor"),e={mode:"code",modes:["code","tree","view","form","text"],onError:function(r){a.error("JSON 格式错误："+r.toString())},mainMenuBar:!0,navigationBar:!1,statusBar:!0,colorPicker:!1,search:!0,format:!0,repair:!0};c.value=new S(t,e)},k=async()=>{try{d.value=!0;const t=await fetch(`${p}/config`);if(t.ok){const e=await t.json();i.value&&i.value.set(e.main.experimental||{}),c.value&&c.value.set(e.main.log||{})}else a.error("加载配置失败")}catch(t){console.error("加载配置失败:",t),a.error("加载配置失败，请检查后端服务是否启动")}finally{d.value=!1}},O=async()=>{try{o.experimental=!0;const t=i.value.get(),e=await fetch(`${p}/experimental`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({experimental:t})});if(e.ok)a.success("实验性功能配置保存成功");else{const r=await e.json();a.error(r.error||"实验性功能配置保存失败")}}catch(t){console.error("保存实验性功能配置失败:",t),a.error("保存失败，请检查JSON格式是否正确")}finally{o.experimental=!1}},C=async()=>{try{o.log=!0;const t=c.value.get(),e=await fetch(`${p}/log`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({log:t})});if(e.ok)a.success("日志配置保存成功");else{const r=await e.json();a.error(r.error||"日志配置保存失败")}}catch(t){console.error("保存日志配置失败:",t),a.error("保存失败，请检查JSON格式是否正确")}finally{o.log=!1}};return b(()=>{w(),B(),setTimeout(()=>{k()},100)}),J(()=>{i.value&&i.value.destroy(),c.value&&c.value.destroy()}),(t,e)=>{const r=f("el-icon"),m=f("el-button"),g=f("el-card"),_=T("loading");return j(),P(M,null,{default:n(()=>[s("div",D,[e[2]||(e[2]=s("div",{class:"page-header"},[s("h2",{class:"page-title"},"其他设置")],-1)),l(g,{class:"box-card"},{header:n(()=>[s("div",L,[e[0]||(e[0]=s("span",null,"实验性功能配置",-1)),l(m,{type:"primary",onClick:O,loading:o.experimental},{default:n(()=>[l(r,null,{default:n(()=>[l(x(y))]),_:1}),h(" "+E(o.experimental?"保存中...":"保存"),1)]),_:1},8,["loading"])])]),default:n(()=>[v(s("div",V,null,512),[[_,o.experimental||d.value]])]),_:1}),l(g,{class:"box-card"},{header:n(()=>[s("div",$,[e[1]||(e[1]=s("span",null,"日志配置",-1)),l(m,{type:"primary",onClick:C,loading:o.log},{default:n(()=>[l(r,null,{default:n(()=>[l(x(y))]),_:1}),h(" "+E(o.log?"保存中...":"保存"),1)]),_:1},8,["loading"])])]),default:n(()=>[v(s("div",A,null,512),[[_,o.log||d.value]])]),_:1})])]),_:1})}}},H=I(U,[["__scopeId","data-v-b4b638e2"]]);export{H as default};
